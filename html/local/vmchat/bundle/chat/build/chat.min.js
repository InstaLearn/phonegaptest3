(function(b){b.widget("ui.footerbar",{options:{id:null,offset:0,width:"100%",barscroll:b(window).width()-430,boxClosed:function(a){}},init:function(a){this.elem=a},widget:function(){return this.uiFooterbar},_create:function(){var a=(this.uiFooterbar=b("<div></div>")).appendTo(document.body).prop("id","stickybar").addClass("maximize"),c=(this.uiFooterbarClosebox=b("<div></div>")).addClass("vmchat_close_bt").prop("id","hide_bar").appendTo(a);(this.uiFooterbarClose=b("<input>")).prop("id","closebtn").prop("type",
"button").prop("title","Close chat").addClass("close").appendTo(c).clickToggle(function(){if(b("#stickybar").hasClass("maximize")){b("#stickybar").removeClass("maximize").addClass("minimize");b("#hide_bar input").removeClass("close").addClass("expand");b("#hide_bar input").prop("title","Open chat");io.disconnect();b(".ui-memblist").remove();b(".ui-chatbox").remove();b("div#chatrm").remove();chatroombox=null;for(key in io.uniquesids)key!=io.cfg.userid&&(chatboxManager.delBox(key),b("li#tabcb"+key).remove());
idList=[];tabs.tabs("refresh");localStorage.clear();vmstorage={};localStorage.setItem("init","false");sessionStorage.removeItem("chatroom");sessionStorage.clear()}},function(){b("#stickybar").removeClass("minimize").addClass("maximize");b("#hide_bar input").removeClass("expand").addClass("close");b("#hide_bar input").prop("title","Close chat");localStorage.clear();io.init(userdata)});uiFooterbarchatroomtab=(this.uiFooterbarchatroomtab=b("<div></div>")).addClass("vmchat_room_bt").prop("id","chatroom_bt").appendTo(a);
uiFooterbarchatroomContent=(this.uiFooterbarchatroomContent=b('<div class = "inner_bt"></div>')).appendTo(uiFooterbarchatroomtab);uiFooterbarchatroomIcon=(this.uiFooterbarchatroomIcon=b('<div id = "chatroom_icon"></div>')).appendTo(uiFooterbarchatroomContent);uiFooterbarchatroomText=(this.uiFooterbarchatroomText=b('<div id = "chatroom_text"></div>')).appendTo(uiFooterbarchatroomContent).text("Chatroom").click(function(){if(chatroombox)"hidden"==sessionStorage.getItem("chatroom_status")?sessionStorage.removeItem("chatroom_status"):
sessionStorage.setItem("chatroom_status","hidden"),chatroombox.chatroom("option","boxManager").toggleBox();else if(0==b("div#chat_room").length){var a=document.createElement("div");a.id="chat_room";document.body.appendChild(a);chatroombox=b("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,offset:"20px",messageSent:function(a,c){b("#chat_room").chatroom("option","boxManager").addMsg(a.name,c)}})}});uiFooterbarUserlisttab=(this.uiFooterbarUserlisttab=b("<div></div>")).addClass("vmchat_bar_button").prop("id",
"user_list").appendTo(a);uiFooterbarUserlistContent=(this.uiFooterbarUserlistContent=b('<div class="inner_bt"></div>')).appendTo(uiFooterbarUserlisttab);uiFooterbarUserlistIcon=(this.uiFooterbarUserlistIcon=b('<div id="usertab_icon"></div>')).appendTo(uiFooterbarUserlistContent);uiFooterbarUserlistText=(this.uiFooterbarUserlistText=b('<div id="usertab_text"></div>')).appendTo(uiFooterbarUserlistContent).text("Private Chat").click(function(){1<Object.keys(io.uniquesids).length&&b("#chat_div").memberlist("option",
"boxManager").toggleBox()});uiFooterbartabCont=(this.uiFooterbartabCont=b("<div></div>")).attr("id","tabs").addClass("tabs-bottom").appendTo(a);uiFooterbartabs=(this.uiFooterbartabs=b('<ul class="tabs"></ul>')).appendTo(uiFooterbartabCont);this._setWidth(this.options.width);this.init(this)},destroy:function(){this.element.remove();this._destroy()},_setWidth:function(a){this.uiFooterbar.width(a+"px")}})})(jQuery);
(function(b){b.fn.clickToggle=function(a,c){var d=[a,c];this.data("toggleclicked",0);this.click(function(){var a=b(this).data(),c=a.toggleclicked;b.proxy(d[c],this)();a.toggleclicked=(c+1)%2});return this}})(jQuery);(function(b){b.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,userSent:function(a){this.boxManager.addUsr(a.name)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addUsr:function(a){var c=this.elem.uiChatboxLog,d=document.createElement("div");c.append(d);if(a){c=document.createElement("a");c.href="#"+a.userid;var e=document.createElement("img");e.src=a.img;c.appendChild(e);e=document.createElement("span");void 0==a.lname&&(a.lname="");
b(e).text(a.name+" "+a.lname);c.appendChild(e);d.appendChild(c)}b(d).addClass("ui-memblist-usr");b(d).attr("id","ml"+a.userid);b(d).fadeIn();this._scrollToBottom()},highlightBox:function(){var a=this;a.elem.uiChatboxTitlebar.effect("highlight",{},300);a.elem.uiChatbox.effect("bounce",{times:3},300,function(){a.highlightLock=!1;a._scrollToBottom()})},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},
toggleContent:function(a){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")},widget:function(){return this.uiChatbox},_create:function(){var a=this,c=a.options.title||"No Title",d=(a.uiChatbox=b("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-memblist").attr("id","memlist").attr("outline",0).css("display","none").focusin(function(){a.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){a.uiChatboxTitlebar.removeClass("ui-state-focus")}),
e=(a.uiChatboxTitlebar=b("<div></div>")).addClass("ui-widget-header ui-corner-top ui-memblist-titlebar ui-dialog-header").click(function(a){}).appendTo(d);(a.uiChatboxTitle=b("<span></span>")).html(c).appendTo(e);var f=(a.uiChatboxTitlebarClose=b('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon ").attr("role","button").hover(function(){f.addClass("ui-state-hover")},function(){f.removeClass("ui-state-hover")});uiChatboxTitlebarMinimize=(a.uiChatboxTitlebarMinimize=b('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon").attr("role",
"button").hover(function(){uiChatboxTitlebarMinimize.addClass("ui-state-hover")},function(){uiChatboxTitlebarMinimize.removeClass("ui-state-hover")}).click(function(a){b("#chat_div").memberlist("option","boxManager").toggleBox();return!1}).appendTo(e);uiChatboxTitlebarMinimizeText=b("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(uiChatboxTitlebarMinimize);uiChatboxContent=(a.uiChatboxContent=b("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(d);
uiChatboxLog=(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-memblist-log").appendTo(uiChatboxContent).focusin(function(){var a=b(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)});e.find("*").add(e).disableSelection();b(document).on("click","#chat_div .ui-memblist-usr a",function(a){var c=b(this);a=c.attr("href").replace("#","");c=c.find("span").html();-1==b.inArray(a,idList)&&(counter++,idList.push(a),vmstorage[a]=[],vmstorage[a].push({userid:a,name:c}));chatboxManager.addBox(a,
{dest:"dest"+counter,title:"box"+counter,first_name:c});chatboxManager.init({user:{name:c},messageSent:function(a,c,d){b("#"+a).chatbox("option","boxManager").addMsg(c.name,d)}});c=a=null});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a)},_setOption:function(a,c){if(null!=c)switch(a){case "hidden":c?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(c);break;case "width":this._setWidth(c)}b.Widget.prototype._setOption.apply(this,
arguments)},_setWidth:function(a){this.uiChatboxTitlebar.width(a+"px");this.uiChatboxLog.width(a+"px")},_position:function(a){this.uiChatbox.css("right",a)}})})(jQuery);(function(b){b.widget("ui.chatbox",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,messageSent:function(a,b,d){this.boxManager.addMsg(b.name,d)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addMsg:function(a,c){var d=this.elem.uiChatboxLog,e=document.createElement("div");d.append(e);d=!1;if(a){var f=document.createElement("b");b(f).text(a+": ");e.appendChild(f)}else d=!0;d=document.createElement(d?"i":"span");b(d).text(c);e.appendChild(d);b(e).addClass("ui-chatbox-msg");
b(e).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){},toggleBox:function(){this.elem.uiChatbox.toggle()},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){},toggleContentbox:function(a){this.uiChatboxContent.is(":visible")?(this.uiChatboxInputBox.focus(),b(b('#tabs ul li[id = "tabcb'+this.options.id+
'"]')).removeClass("ui-state-active")):b(b('#tabs ul li[id="tabcb'+this.options.id+'"]')).addClass("ui-state-active");this.uiChatbox.toggle("slide",{direction:"down"},1E3)},widget:function(){return this.uiChatbox},_create:function(){createTab(this.options.id,this.options.title);var a=this,c=a.options.title||"No Title",d=(a.uiChatbox=b("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatbox").attr("id","cb"+a.options.id).attr("outline",0).focusin(function(){a.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){a.uiChatboxTitlebar.removeClass("ui-state-focus")}),
e=(a.uiChatboxTitlebar=b("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatbox-titlebar ui-dialog-header").click(function(a){}).appendTo(d);(a.uiChatboxTitle=b("<span></span>")).html(c).appendTo(e);var f=(a.uiChatboxTitlebarClose=b('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon ").attr("role","button").hover(function(){f.addClass("ui-state-hover")},function(){f.removeClass("ui-state-hover")}).click(function(c){d.hide();a.options.boxClosed(a.options.id);b("#tabcb"+a.options.id).remove();
delete vmstorage[a.options.id];localStorage.removeItem(a.options.id);return!1}).appendTo(e);b("<span></span>").addClass("ui-icon ui-icon-closethick").text("close").appendTo(f);var g=(a.uiChatboxTitlebarMinimize=b('<a href = "#"></a>')).addClass("ui-corner-all ui-chatbox-icon").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).click(function(b){a.toggleContentbox(b);"hidden"==localStorage.getItem(a.options.id)?localStorage.removeItem(a.options.id):
localStorage.setItem(a.options.id,"hidden");return!1}).appendTo(e);b("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(g);c=(a.uiChatboxContent=b("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(d);(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-chatbox-log").appendTo(c);var h=(a.uiChatboxInput=b("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(c),k=(a.uiChatboxInputBox=b("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id",
"ta"+a.options.id).appendTo(h).keypress(function(c){if(c.keyCode&&c.keyCode==b.ui.keyCode.ENTER){msg=b.trim(b(this).val());if(0<msg.length){io.send(msg,a.options.id);b(this).val("");b("#"+a.options.id).chatbox("option").messageSent(a.options.id,{name:io.cfg.userobj.name},msg);c=a.options.id;"undefined"==typeof vmstorage[c]&&(vmstorage[c]=[]);var d=(new Date).getTime();vmstorage[c].push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:d})}return!1}}).focusin(function(){k.addClass("ui-chatbox-input-focus");
var a=b(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){k.removeClass("ui-chatbox-input-focus")});e.find("*").add(e).disableSelection();c.children().click(function(){a.uiChatboxInputBox.focus()});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a);a.options.hidden||d.show();b(b('#tabs ul li[id = "tabcb'+a.options.id+'"]')).append(d)},_setOption:function(a,c){if(null!=c)switch(a){case "hidden":c?this.uiChatbox.hide():this.uiChatbox.show();
break;case "offset":this._position(c);break;case "width":this._setWidth(c)}b.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatbox.width(a+"px");this.uiChatboxInputBox.css("width",a-14+"px")},_position:function(a){}})})(jQuery);(function(b){b.widget("ui.chatroom",{options:{id:null,title:null,user:null,hidden:!1,offset:20,width:230,messageSent:function(a,b){this.boxManager.addMsg(a.name,b)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addMsg:function(a,c){var d=this.elem.uiChatboxLog,e=document.createElement("div");d.append(e);d=!1;if(a){var f=document.createElement("b");b(f).text(a+": ");e.appendChild(f)}else d=!0;d=document.createElement(d?"i":"span");b(d).text(c);e.appendChild(d);b(e).addClass("ui-chatbox-msg");
b(e).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){this.elem.uiChatboxTitlebar.addClass("ui-state-highlight");this.highlightLock=!1;this._scrollToBottom()},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){this.uiChatboxContent.toggle();
this.uiChatboxContent.is(":visible")&&this.uiChatboxInputBox.focus()},widget:function(){return this.uiChatbox},_create:function(){var a=this,c=a.options,d=c.title||"No Title",e=(a.uiChatbox=b("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatroom").prop("id","chatrm").prop("outline",0).focusin(function(){a.uiChatboxTitlebar.removeClass("ui-state-highlight");a.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){a.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(a.uiChatboxTitlebar=b("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatroom-titlebar ui-dialog-header").click(function(b){a.uiChatboxTitlebar.removeClass("ui-state-highlight")}).appendTo(e);(a.uiChatboxTitle=b("<span></span>")).html(d).appendTo(f);var g=(a.uiChatboxTitlebarMinimize=b('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon").prop("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).focus(function(){g.addClass("ui-state-focus")}).blur(function(){g.removeClass("ui-state-focus")}).click(function(a){c.boxManager.toggleBox();
sessionStorage.setItem("chatroom_status","hidden");return!1}).appendTo(f);b("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(g);d=(a.uiChatboxContent=b("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(e);(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-chatbox-log").appendTo(d);var h=(a.uiChatboxInput=b("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(d),k=(a.uiChatboxInputBox=b("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id",
"ta_chrm").appendTo(h).keydown(function(c){if(c.keyCode&&c.keyCode==b.ui.keyCode.ENTER){msg=b.trim(b(this).val());c={receiver:"chatroom",msg:msg};if(0<msg.length)if(io.send(c),b(this).val(""),a.options.messageSent({name:io.cfg.userobj.name},msg),c=(new Date).getTime(),null!=sessionStorage.getItem("chatroom")){var d=JSON.parse(sessionStorage.getItem("chatroom"));d.push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:c});sessionStorage.setItem("chatroom",JSON.stringify(d))}else sessionStorage.setItem("chatroom",
JSON.stringify([{userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:c}]));return!1}}).focusin(function(){k.addClass("ui-chatbox-input-focus");var a=b(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){k.removeClass("ui-chatbox-input-focus")});f.find("*").add(f).disableSelection();d.children().click(function(){a.uiChatboxInputBox.focus()});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a);a.options.hidden||e.show()},_setOption:function(a,
c){if(null!=c)switch(a){case "hidden":c?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(c);break;case "width":this._setWidth(c)}b.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatbox.width(a+"px");this.uiChatboxInputBox.css("width",a-14+"px")},_position:function(a){this.uiChatbox.css("left",a)}})})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++)if(this[a]==b)return a;return-1});
var chatboxManager=function(){var b=[],a=[],c={width:230,gap:20,maxBoxes:5,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b,c)}},d=function(d){var e=a.indexOf(d);if(-1!=e)for(a.splice(e,1),b.splice(e,1),diff=c.width+c.gap,d=e;d<a.length;d++)offset=$("#"+a[d]).chatbox("option","offset"),$("#"+a[d]).chatbox("option","offset",offset-diff);else alert("should not happen: "+d)},e=function(a,d,e){b.indexOf(d.userid);c.messageSent(a,d,e)};return{init:function(a){$.extend(c,a)},
addBox:function(f,g,h){h=a.indexOf(f);var k=b.indexOf(f);-1==h&&(-1!=k?($("#"+f).chatbox("option","offset",285+(c.width+c.gap)*a.length),$("#"+f).chatbox("option","boxManager").toggleBox(),a.push(f),g=-1,g=$("#tabs li").index($("#tabcb"+f)),$($(".tabs li")[g]).css("display","list-item"),$("#tabs").tabs("option","active",g),$("#tabs").tabs("show")):(void 0==g.last_name&&(g.last_name=""),h=document.createElement("div"),h.setAttribute("id",f),$(h).chatbox({id:f,user:g,title:g.first_name+" "+g.last_name,
hidden:!1,width:c.width,offset:285+(c.width+c.gap)*a.length,messageSent:e,boxClosed:d}),b.push(f),a.push(f)))},delBox:function(c){a=$.grep(a,function(a){return c!=a});b=$.grep(b,function(a){return c!=a})},dispatch:function(a,b){$("#"+a.userid).chatbox("option","boxManager").addMsg(a.name,b)}}}();counter=0;idList=[];chatroombox=null;
function memberUpdate(b){b=b.message;var a="undefined"===typeof wwwroot?"./images/online.png":wwwroot+"local/vmchat/bundle/chat/images/online.png";if(0<b.length){var c=b.length-1;$("#user_list .inner_bt #usertab_icon").css({background:"url("+a+")no-repeat top left"})}$("#user_list .inner_bt #usertab_text").text(lang.whos+" ("+c+")");$("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" ("+c+")");1<b.length?(document.getElementById("chat_div")||(c=document.createElement("div"),c.id="chat_div",
document.body.appendChild(c)),$("#chat_div").memberlist({id:"chat_div",user:b,offset:"37px",title:lang.online,userSent:function(a){$("#chat_div").memberlist("option","boxManager").addUsr(a)}}),$("#chat_div .ui-memblist-usr").remove(),$.each(b,function(a,b){b.userid!=io.cfg.userid&&$("#chat_div").memberlist("option").userSent(b)})):$("div#memlist").length&&$("div#memlist").remove()}
function messageUpdate(b){var a=$.isPlainObject(b.message)?b.message.msg:b.message,c=b.toUser,d=b.fromUser,e=io.cfg.userid,f=(new Date).getTime();if("chatroom"==b.message.receiver&&(""==c||void 0==c))e==d.userid||chatroombox||0!=$("div#chat_room").length||(b=document.createElement("div"),b.id="chat_room",document.body.appendChild(b),chatroombox=$("#chat_room").chatroom({id:"chat_room",user:d,title:lang.chatroom_header,messageSent:function(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,
b)}})),$("#chat_room").chatroom("option").messageSent(d,a),null!=sessionStorage.getItem("chatroom")?(b=JSON.parse(sessionStorage.getItem("chatroom")),b.push({userid:d.userid,name:d.name,msg:a,time:f}),sessionStorage.setItem("chatroom",JSON.stringify(b))):sessionStorage.setItem("chatroom",JSON.stringify([{userid:d.userid,name:d.name,msg:a,time:f}]));else if(void 0!=c&&""!=c){if(e==c.userid&&d.userid!=e){-1==$.inArray(d.userid,idList)&&(counter++,idList.push(d.userid),vmstorage[d.userid]=[],vmstorage[d.userid].push({userid:d.userid,
name:d.name+" "+d.lname}));chatboxManager.addBox(d.userid,{dest:"dest"+counter,title:"box"+counter,first_name:d.name,last_name:d.lname});chatboxManager.init({user:d,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}});$("#"+d.userid).chatbox("option").messageSent(d.userid,d,a);$("li[aria-controls='tabcb"+d.userid+"']").addClass("ui-state-highlight");var g=d.userid}vmstorage[g].push({userid:d.userid,name:d.name,msg:a,time:f})}}
function statusUpdate(b,a,c){$("#"+b.userid).length&&($("#"+b.userid).chatbox("option").messageSent(b.userid,b,a),$("#ta"+b.userid).prop("disabled",c))}function common_chatbox_update(b,a){$("div#chat_room").length&&$("#chat_room").chatroom("option").messageSent(b,a)}function newStatus(b){$.each(b.message,function(a,c){null!=b.newuser&&c.userid==b.newuser&&(statusUpdate(c,"Online",!1),common_chatbox_update(c,"Online"))})}
function createTab(b,a){var c=$("#tabs").tabs(),d=$("div#tabs ul li").length;tabId="tabcb"+b;addTab(c,tabId,d,a)}
function addTab(b,a,c,d){var e=$("#tab_content");c=d||"Tab "+c;a=$(("<li id = '"+a+"' class = 'ui-state-default ui-corner-bottom ui-tabs-active ui-state-active' aria-controls = '"+a+"'><a href = '#{href}' class = 'ui-tabs-anchor'>#{label}</a> <a href = '#' role = 'button'class = 'ui-corner-all ui-chatbox-icon'><span class = 'ui-icon ui-icon-close'>close</span></a></li>").replace(/#\{href\}/g,"#"+a).replace(/#\{label\}/g,c));e.val();b.find(".ui-tabs-nav").append(a)}
function browserSupportsLocalStorage(){return"localStorage"in window&&null!=window.localStorage}
function displaycomChatHistory(){if(0<sessionStorage.length){var b=document.createElement("div");b.id="chat_room";document.body.appendChild(b);b=JSON.parse(sessionStorage.getItem("chatroom"));$.each(b,function(a,b){1>a&&(chatroombox=$("#chat_room").chatroom({id:"chat_room",user:b,title:"Common chat",messageSent:function(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}}));$("#chat_room").chatroom("option").messageSent(b,b.msg)})}"hidden"==sessionStorage.getItem("chatroom_status")&&
$("#chatrm").hide()}
function displayChatHistory(){if(null!=localStorage.getItem(sid)){var b=JSON.parse(localStorage.getItem(sid));$.each(b,function(a,b){counter++;idList.push(a);$.each(b,function(b,c){1>b?(chatboxManager.addBox(a,{dest:"dest"+counter,title:"box"+counter,first_name:c.name}),chatboxManager.init({messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}})):$("#"+a).chatbox("option").messageSent(a,c,c.msg)});"hidden"==localStorage.getItem(a)&&($("#cb"+a).hide(),$("#tabcb"+a).removeClass("ui-state-active"))})}}
function display_error(b){$("<div id = 'dialog' title = 'VmChat Error:'></div>").prependTo("#stickybar");$("#dialog").html(b);$("#dialog").dialog()};var lang={online:"Online Users",whos:"Who's online",chatroom:"Chatroom",chatroom_header:"Common Chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard"};
